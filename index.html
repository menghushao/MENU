<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>A11~A106 ä¸‹æ‹‰é¸å–®</title>
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 30px; }
    select { padding: 6px 12px; font-size: 16px; }
    label { font-weight: bold; margin-right: 10px; }
    #loader { color: gray; margin-top: 10px; }
  </style>
</head>
<body>

<h2>ğŸ“‹ A11 ~ A106 è³‡æ–™ä¸‹æ‹‰é¸å–®</h2>
<label for="dropdown">é¸é …ï¼š</label>
<select id="dropdown">
  <option value="">è«‹ç­‰å¾…è³‡æ–™è®€å–ä¸­...</option>
</select>
<div id="loader">ğŸ” æ­£åœ¨æŠ“å–ä¸¦è§£å¯†è³‡æ–™...</div>

<script>
(async () => {
  const TOKEN = prompt("ğŸ” è«‹è¼¸å…¥ GitHub Token");
  if (!TOKEN) {
    alert("âŒ æœªè¼¸å…¥ï¼Œç„¡æ³•ç¹¼çºŒ");
    return;
  }

  const key = CryptoJS.enc.Utf8.parse(TOKEN.trim().slice(0, 32).padEnd(32, '0'));
  const url = "https://raw.githubusercontent.com/menghushao/Order-management-product/main/gridData.json";
  const dropdown = document.getElementById("dropdown");
  const loader = document.getElementById("loader");

  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error("è³‡æ–™è¼‰å…¥å¤±æ•—");
    const json = await res.json();

    const iv = CryptoJS.enc.Hex.parse(json.iv);
    const encrypted = CryptoJS.enc.Base64.parse(json.ciphertext);
    const decrypted = CryptoJS.AES.decrypt({ ciphertext: encrypted }, key, { iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 });
    const raw = decrypted.toString(CryptoJS.enc.Utf8);
    const grid = JSON.parse(raw);

    const values = new Set();
    for (let r = 10; r <= 105; r++) {
      const val = grid[r]?.[0];
      if (val?.trim()) values.add(val.trim());
    }

    dropdown.innerHTML = '<option value="">è«‹é¸æ“‡</option>';
    [...values].forEach(v => {
      const opt = document.createElement("option");
      opt.value = opt.textContent = v;
      dropdown.appendChild(opt);
    });

    loader.textContent = `âœ… è¼‰å…¥å®Œæˆï¼Œå…± ${values.size} å€‹é¸é …`;
  } catch (err) {
    console.error(err);
    loader.textContent = "âŒ è§£å¯†æˆ–è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªé‡‘é‘°èˆ‡è³‡æ–™æ˜¯å¦æ­£ç¢º";
    dropdown.innerHTML = '<option value="">è®€å–å¤±æ•—</option>';
  }
})();
</script>

</body>
</html>
